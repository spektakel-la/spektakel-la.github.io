<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.data.settings.google-tag }}"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
</script>

<script>
  function getConsentGranted() {
    try {
      return localStorage.getItem('consentGranted') || 'false';
    } catch(_err){}
    return 'false';
  }

  function setConsentGranted(isGranted) {
    try {
      if (isGranted){
        gtag('consent', 'update', {
            ad_user_data: 'granted',
            ad_personalization: 'granted',
            ad_storage: 'granted',
            analytics_storage: 'granted'
        });
      } else {
        gtag('consent', 'default', {
          'ad_user_data': 'denied',
          'ad_personalization': 'denied',
          'ad_storage': 'denied',
          'analytics_storage': 'denied',
          'wait_for_update': 500,
        });
        localStorage.setItem("consentGranted", `${isGranted}`);
      }
    } catch(_err){}
  }
</script>

<script>
  dataLayer.push({'gtm.start': new Date().getTime(), 'event': 'gtm.js'});
  setConsentGranted(false);
</script>